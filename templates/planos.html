{% extends "layout.html" %}

{% block title %}Gerir Planos{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold text-gray-900">Gerir Planos de Assinatura</h1>

<!-- Formulário para Adicionar Plano -->
<div class="mt-6 bg-white shadow sm:rounded-lg">
  <div class="px-4 py-5 sm:p-6">
    <h3 class="text-base font-semibold leading-6 text-gray-900">Adicionar Novo Plano</h3>
    <p class="mt-2 max-w-xl text-sm text-gray-500">
      Crie os planos de assinatura (ex: Mensal, Anual) que serão oferecidos aos seus clientes.
    </p>
    <form class="mt-5 grid grid-cols-1 gap-y-6 sm:grid-cols-6 sm:gap-x-4" action="{{ url_for('planos') }}" method="POST">
      
      <div class="sm:col-span-3">
        <label for="nome" class="block text-sm font-medium leading-6 text-gray-900">Nome do Plano</label>
        <div class="mt-2">
          <input type="text" name="nome" id="nome" required placeholder="Ex: Plano VIP Mensal" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
        </div>
      </div>

      <div class="sm:col-span-3">
        <label for="preco" class="block text-sm font-medium leading-6 text-gray-900">Preço (R$)</label>
        <div class="mt-2">
          <input type="number" step="0.01" name="preco" id="preco" required placeholder="Ex: 29.90" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
        </div>
      </div>

      <div class="sm:col-span-3">
        <label for="frequencia" class="block text-sm font-medium leading-6 text-gray-900">Frequência da Cobrança</label>
        <div class="mt-2">
          <select id="frequencia" name="frequencia" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
            <option value="months">Meses</option>
            <option value="years">Anos</option>
          </select>
        </div>
      </div>

      <div class="sm:col-span-3">
        <label for="intervalo" class="block text-sm font-medium leading-6 text-gray-900">Intervalo</label>
        <div class="mt-2">
          <input type="number" name="intervalo" id="intervalo" required value="1" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
          <p class="mt-1 text-xs text-gray-500">Ex: 1 para cobrar a cada mês/ano.</p>
        </div>
      </div>

      <div class="sm:col-span-6">
        <button type="submit" class="inline-flex w-full justify-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 sm:w-auto">Criar Plano</button>
      </div>
    </form>
  </div>
</div>

<!-- Tabela de Planos Existentes -->
<div class="mt-8 flow-root">
    <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
      <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
        <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg">
          <table class="min-w-full divide-y divide-gray-300">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">Nome do Plano</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Preço</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Recorrência</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">ID no Mercado Pago</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 bg-white">
              {% for plano in planos %}
              <tr>
                <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6">{{ plano.nome }}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">R$ {{ "%.2f"|format(plano.preco) }}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">A cada {{ plano.intervalo }} {{ 'Mês' if plano.frequencia == 'months' else 'Ano' }}{{ 's' if plano.intervalo > 1 else '' }}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm font-mono text-gray-500">{{ plano.id_plano_mp }}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                    {% if plano.ativo %}
                        <span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">Ativo</span>
                    {% else %}
                        <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">Inativo</span>
                    {% endif %}
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="5" class="py-4 text-center text-sm text-gray-500">Nenhum plano de assinatura criado.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
</div>
{% endblock %}
